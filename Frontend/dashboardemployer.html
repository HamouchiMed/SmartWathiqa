<!doctype html>
<html lang="fr" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Documents</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'DM Sans', sans-serif; }
    .doc-card {
      transition: all 0.2s ease;
    }
    .doc-card:hover {
      transform: translateY(-2px);
    }
    .category-pill {
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .modal-backdrop {
      animation: fadeInBackdrop 0.2s ease;
    }
    @keyframes fadeInBackdrop {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full overflow-auto" style="background: #ffffff;"><!-- Header -->
   <header class="sticky top-0 z-40 backdrop-blur-xl border-b" style="background: #ffffff; border-color: #e2e8f0;">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
     <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
       </div>
       <div>
        <h1 id="app-title" class="text-xl font-bold mb-2" style="color: #1e293b;">Gestion des Documents</h1>
        <p id="welcome-message" class="text-sm" style="color: #64748b;">Organisez et gérez vos fichiers</p>
       </div>
      </div>
      <div class="flex items-center gap-3">
       <button id="add-doc-btn" class="flex items-center gap-2 px-4 py-2.5 rounded-xl font-semibold text-white transition-all hover:opacity-90" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg><span class="hidden sm:inline">Nouveau Document</span> </button>
      </div>
     </div>
    </div>
   </header><!-- Drawer Menu -->
   <div id="drawer" class="fixed left-0 top-0 h-screen z-40 w-72 overflow-y-auto" style="background: rgb(0, 94, 184);">
    <!-- Header -->
    <div class="p-6 border-b" style="border-color: rgb(0, 94, 184); background: rgb(0, 94, 184)">
     <h2 class="text-lg font-bold" style="color: #ffffff;">SmartWathiqa</h2>
    </div>

    <!-- User Profile Section -->
    <div class="p-6" style="border-bottom: 1px solid rgb(0, 94, 184);">
     <div class="flex items-center gap-3 mb-4">
      <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background: #ffffff; color: #005EB8;">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
       </svg>
      </div>
      <div>
       <p class="text-white font-semibold text-sm">Mon Compte</p>
       <p class="text-blue-100 text-xs">utilisateur@example.com</p>
      </div>
     </div>
    </div>

    <!-- Main Navigation -->
    <nav class="p-4" style="border-bottom: 1px solid rgb(0, 94, 184);">
     <p class="text-blue-100 text-xs font-semibold mb-3 px-2 uppercase">Navigation</p>
     <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors" style="color: #ffffff;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-3m0 0l7-4 7 4M5 9v10a1 1 0 001 1h12a1 1 0 001-1V9m-9 11l4-4m0 0l-4-4m4 4l4 4m0-4l-4-4" />
      </svg>
      <span>Tableau de bord</span>
     </a>
     <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors" style="color: #ffffff;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2z" />
      </svg>
      <span>Mes documents</span>
     </a>
     <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors" style="color: #ffffff;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span>Galerie</span>
     </a>
    </nav>

    <!-- Favorites Section -->
    <div class="p-4" style="border-bottom: 1px solid rgb(0, 94, 184);">
     <p class="text-blue-100 text-xs font-semibold mb-3 px-2 uppercase">Favoris</p>
     <a href="#" class="flex items-center gap-3 px-4 py-2 rounded-lg transition-colors" style="color: #ffffff; font-size: 14px;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-4 h-4" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
      </svg>
      <span>Documents importants</span>
     </a>
     <a href="#" class="flex items-center gap-3 px-4 py-2 rounded-lg transition-colors" style="color: #ffffff; font-size: 14px;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-4 h-4" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
      </svg>
      <span>Contrats</span>
     </a>
    </div>

    <!-- Recent Documents Section -->
    <div class="p-4" style="border-bottom: 1px solid rgb(0, 94, 184);">
     <p class="text-blue-100 text-xs font-semibold mb-3 px-2 uppercase">Récemment accédés</p>
     <a href="#" class="flex items-center gap-3 px-4 py-2 rounded-lg transition-colors mb-2" style="color: #ffffff; font-size: 14px;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <span class="truncate">Rapport_Q4_2025.pdf</span>
     </a>
     <a href="#" class="flex items-center gap-3 px-4 py-2 rounded-lg transition-colors mb-2" style="color: #ffffff; font-size: 14px;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <span class="truncate">Contrat_Client_XYZ.docx</span>
     </a>
     <a href="#" class="flex items-center gap-3 px-4 py-2 rounded-lg transition-colors" style="color: #ffffff; font-size: 14px;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <span class="truncate">Budget_2026.xlsx</span>
     </a>
    </div>

    <!-- Footer -->
    <div class="p-4" style="border-top: 1px solid rgb(0, 94, 184);">
     <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-colors" style="color: #ffffff;" onmouseover="this.style.background='rgb(0, 94, 184)'" onmouseout="this.style.background='transparent'">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      <span>Paramètres</span>
     </a>
    </div>
   </div><!-- Main Content -->
   <main class="ml-72 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Stats Bar -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8">
     <div class="rounded-2xl p-4 border" style="background: #f8fafc; border-color: #e2e8f0;">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: rgba(99, 102, 241, 0.15);">
        <svg class="w-5 h-5" style="color: #818cf8;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
       </div>
       <div>
        <p class="text-2xl font-bold" style="color: #1e293b;" id="total-docs">0</p>
        <p class="text-xs" style="color: #64748b;">Total</p>
       </div>
      </div>
     </div>
     <div class="rounded-2xl p-4 border" style="background: #f8fafc; border-color: #e2e8f0;">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: rgba(34, 197, 94, 0.15);">
        <svg class="w-5 h-5" style="color: #4ade80;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
       </div>
       <div>
        <p class="text-2xl font-bold" style="color: #1e293b;" id="pdf-count">0</p>
        <p class="text-xs" style="color: #64748b;">PDF</p>
       </div>
      </div>
     </div>
     <div class="rounded-2xl p-4 border" style="background: #f8fafc; border-color: #e2e8f0;">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: rgba(59, 130, 246, 0.15);">
        <svg class="w-5 h-5" style="color: #60a5fa;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
       </div>
       <div>
        <p class="text-2xl font-bold" style="color: #1e293b;" id="image-count">0</p>
        <p class="text-xs" style="color: #64748b;">Images</p>
       </div>
      </div>
     </div>
     <div class="rounded-2xl p-4 border" style="background: #f8fafc; border-color: #e2e8f0;">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: rgba(249, 115, 22, 0.15);">
        <svg class="w-5 h-5" style="color: #fb923c;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
        </svg>
       </div>
       <div>
        <p class="text-2xl font-bold" style="color: #1e293b;" id="other-count">0</p>
        <p class="text-xs" style="color: #64748b;">Autres</p>
       </div>
      </div>
     </div>
    </div><!-- Filter & Search -->
    <div class="flex flex-col sm:flex-row gap-4 mb-6">
     <div class="flex-1 relative">
      <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5" style="color: #94a3b8;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg><input type="text" id="search-input" placeholder="Rechercher un document..." class="w-full pl-12 pr-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all" style="background: #f8fafc; border-color: #e2e8f0; color: #1e293b; --tw-ring-color: #6366f1;"><style>#search-input::placeholder { color: #cbd5e1; }</style>
     </div><select id="category-filter" class="px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all cursor-pointer" style="background: #f8fafc; border-color: #e2e8f0; color: #1e293b; --tw-ring-color: #6366f1;"> <option value="all">Toutes les catégories</option> <option value="Travail">Travail</option> <option value="Personnel">Personnel</option> <option value="Finance">Finance</option> <option value="Juridique">Juridique</option> <option value="Autre">Autre</option> </select>
    </div><!-- Documents Grid -->
    <div id="documents-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Documents will be rendered here -->
    </div><!-- Empty State -->
    <div id="empty-state" class="hidden text-center py-16">
     <div class="w-20 h-20 mx-auto mb-6 rounded-2xl flex items-center justify-center" style="background: rgba(99, 102, 241, 0.1); color: #6366f1;">
      <svg class="w-10 h-10" style="color: #6366f1;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
     </div>
     <h3 class="text-xl font-semibold mb-2" style="color: #1e293b;">Aucun document</h3>
     <p class="mb-6" style="color: #64748b;">Commencez par ajouter votre premier document</p><button id="add-first-doc" class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-white transition-all hover:opacity-90" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg> Ajouter un document </button>
    </div><!-- Limit Warning -->
    <div id="limit-warning" class="hidden mt-4 p-4 rounded-xl border" style="background: rgba(249, 115, 22, 0.1); border-color: #fbbf24;">
     <p class="text-sm font-medium" style="color: #d97706;">⚠️ Vous avez atteint la limite de 999 documents. Veuillez en supprimer pour en ajouter de nouveaux.</p>
    </div>
   </main><!-- Add/Edit Modal -->
   <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="modal-backdrop absolute inset-0" style="background: rgba(0, 0, 0, 0.5);" onclick="closeModal()"></div>
    <div class="relative w-full max-w-md rounded-2xl border p-6" style="background: #ffffff; border-color: #e2e8f0; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);"><button onclick="closeModal()" class="absolute top-4 right-4 p-2 rounded-lg transition-colors hover:bg-gray-100" style="color: #94a3b8;">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
     <h2 id="modal-title" class="text-xl font-bold mb-6" style="color: #1e293b;">Nouveau Document</h2>
     <form id="doc-form" class="space-y-4">
      <div><label for="doc-name" class="block text-sm font-medium mb-2" style="color: #334155;">Nom du document *</label> <input type="text" id="doc-name" required class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all" style="background: #f8fafc; border-color: #e2e8f0; color: #1e293b; --tw-ring-color: #6366f1;" placeholder="Ex: Contrat de travail"><style>#doc-name::placeholder { color: #cbd5e1; }</style>
      </div>
      <div><label for="doc-type" class="block text-sm font-medium mb-2" style="color: #334155;">Type de fichier *</label> <select id="doc-type" required class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all cursor-pointer" style="background: #f8fafc; border-color: #e2e8f0; color: #1e293b; --tw-ring-color: #6366f1;"> <option value="">Sélectionner un type</option> <option value="PDF">PDF</option> <option value="Word">Word</option> <option value="Excel">Excel</option> <option value="Image">Image</option> <option value="Autre">Autre</option> </select>
      </div>
      <div><label for="doc-category" class="block text-sm font-medium mb-2" style="color: #334155;">Catégorie *</label> <select id="doc-category" required class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all cursor-pointer" style="background: #f8fafc; border-color: #e2e8f0; color: #1e293b; --tw-ring-color: #6366f1;"> <option value="">Sélectionner une catégorie</option> <option value="Travail">Travail</option> <option value="Personnel">Personnel</option> <option value="Finance">Finance</option> <option value="Juridique">Juridique</option> <option value="Autre">Autre</option> </select>
      </div>
      <div><label for="doc-size" class="block text-sm font-medium mb-2" style="color: #334155;">Taille</label> <input type="text" id="doc-size" class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all" style="background: #f8fafc; border-color: #e2e8f0; color: #1e293b; --tw-ring-color: #6366f1;" placeholder="Ex: 2.5 MB"><style>#doc-size::placeholder { color: #cbd5e1; }</style>
      </div>
      <div><label for="doc-description" class="block text-sm font-medium mb-2" style="color: #334155;">Description</label> <textarea id="doc-description" rows="3" class="w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 transition-all resize-none" style="background: #f8fafc; border-color: #e2e8f0; color: #1e293b; --tw-ring-color: #6366f1;" placeholder="Description du document..."><style>#doc-description::placeholder { color: #cbd5e1; }</style></textarea>
      </div><button type="submit" id="submit-btn" class="w-full py-3 rounded-xl font-semibold text-white transition-all hover:opacity-90 flex items-center justify-center gap-2" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);"> <span id="submit-text">Ajouter le document</span>
       <svg id="submit-spinner" class="hidden w-5 h-5 animate-spin" fill="none" viewbox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
       </svg></button>
     </form>
    </div>
   </div><!-- Delete Confirmation Modal -->
   <div id="delete-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="modal-backdrop absolute inset-0" style="background: rgba(0, 0, 0, 0.5);" onclick="closeDeleteModal()"></div>
    <div class="relative w-full max-w-sm rounded-2xl border p-6 text-center" style="background: #ffffff; border-color: #e2e8f0; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
     <div class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center" style="background: rgba(239, 68, 68, 0.1);">
      <svg class="w-8 h-8" style="color: #ef4444;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
     </div>
     <h3 class="text-lg font-bold mb-2" style="color: #1e293b;">Supprimer ce document ?</h3>
     <p class="text-sm mb-6" style="color: #64748b;">Cette action est irréversible.</p>
     <div class="flex gap-3"><button onclick="closeDeleteModal()" class="flex-1 py-2.5 rounded-xl font-medium border transition-colors hover:bg-gray-100" style="color: #334155; border-color: #e2e8f0;"> Annuler </button> <button id="confirm-delete-btn" class="flex-1 py-2.5 rounded-xl font-medium text-white transition-all hover:opacity-90" style="background: #ef4444;"> Supprimer </button>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="hidden fixed bottom-6 right-6 z-50 px-6 py-4 rounded-xl shadow-2xl border transition-all transform" style="background: #ffffff; border-color: #e2e8f0; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
    <div class="flex items-center gap-3">
     <div id="toast-icon" class="w-8 h-8 rounded-full flex items-center justify-center" style="background: rgba(34, 197, 94, 0.2);">
      <svg class="w-5 h-5" style="color: #4ade80;" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
     </div>
     <p id="toast-message" class="font-medium" style="color: #1e293b;">Document ajouté avec succès</p>
    </div>
   </div>
  </div>
  <script>
    // State
    let documents = [];
    let editingDoc = null;
    let deletingDoc = null;
    let currentRecordCount = 0;

    // Default config
    const defaultConfig = {
      app_title: 'Gestion des Documents',
      welcome_message: 'Organisez et gérez vos fichiers',
      background_color: '#0f172a',
      surface_color: '#1e293b',
      text_color: '#f1f5f9',
      primary_action_color: '#6366f1',
      secondary_action_color: '#94a3b8',
      font_family: 'DM Sans',
      font_size: 16
    };

    // Data Handler
    const dataHandler = {
      onDataChanged(data) {
        documents = data;
        currentRecordCount = data.length;
        renderDocuments();
        updateStats();
      }
    };

    // Element SDK Handler
    async function onConfigChange(config) {
      const appTitle = document.getElementById('app-title');
      const welcomeMsg = document.getElementById('welcome-message');
      
      if (appTitle) appTitle.textContent = config.app_title || defaultConfig.app_title;
      if (welcomeMsg) welcomeMsg.textContent = config.welcome_message || defaultConfig.welcome_message;

      // Apply colors
      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;

      document.body.style.fontFamily = `${fontFamily}, sans-serif`;
      
      const app = document.getElementById('app');
      if (app) app.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${surfaceColor} 50%, #334155 100%)`;

      // Update text colors
      document.querySelectorAll('[style*="color: #f1f5f9"]').forEach(el => {
        el.style.color = textColor;
      });

      // Update primary action colors (buttons)
      document.querySelectorAll('[style*="background: linear-gradient(135deg, #6366f1"]').forEach(el => {
        el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${lightenColor(primaryColor, 20)} 100%)`;
      });
    }

    function lightenColor(hex, percent) {
      const num = parseInt(hex.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => { config.surface_color = value; window.elementSdk.setConfig({ surface_color: value }); }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => { config.primary_action_color = value; window.elementSdk.setConfig({ primary_action_color: value }); }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => { config.secondary_action_color = value; window.elementSdk.setConfig({ secondary_action_color: value }); }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['welcome_message', config.welcome_message || defaultConfig.welcome_message]
      ]);
    }

    // Initialize SDKs
    async function init() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }

      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('Erreur de connexion', 'error');
        }
      }

      setupEventListeners();
    }

    // Get document type icon
    function getTypeIcon(type) {
      const icons = {
        'PDF': `<svg class="w-6 h-6" style="color: #ef4444;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>`,
        'Word': `<svg class="w-6 h-6" style="color: #3b82f6;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>`,
        'Excel': `<svg class="w-6 h-6" style="color: #22c55e;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/></svg>`,
        'Image': `<svg class="w-6 h-6" style="color: #a855f7;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`,
        'Autre': `<svg class="w-6 h-6" style="color: #f59e0b;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>`
      };
      return icons[type] || icons['Autre'];
    }

    // Get category color
    function getCategoryColor(category) {
      const colors = {
        'Travail': { bg: 'rgba(59, 130, 246, 0.2)', text: '#60a5fa' },
        'Personnel': { bg: 'rgba(168, 85, 247, 0.2)', text: '#c084fc' },
        'Finance': { bg: 'rgba(34, 197, 94, 0.2)', text: '#4ade80' },
        'Juridique': { bg: 'rgba(239, 68, 68, 0.2)', text: '#f87171' },
        'Autre': { bg: 'rgba(249, 115, 22, 0.2)', text: '#fb923c' }
      };
      return colors[category] || colors['Autre'];
    }

    // Format date
    function formatDate(isoString) {
      const date = new Date(isoString);
      return date.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    // Render documents
    function renderDocuments() {
      const grid = document.getElementById('documents-grid');
      const emptyState = document.getElementById('empty-state');
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const categoryFilter = document.getElementById('category-filter').value;

      let filteredDocs = documents.filter(doc => {
        const matchesSearch = doc.name.toLowerCase().includes(searchTerm) || 
                              (doc.description && doc.description.toLowerCase().includes(searchTerm));
        const matchesCategory = categoryFilter === 'all' || doc.category === categoryFilter;
        return matchesSearch && matchesCategory;
      });

      if (documents.length === 0) {
        grid.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }

      grid.classList.remove('hidden');
      emptyState.classList.add('hidden');

      // Update existing or create new elements
      const existingCards = new Map([...grid.children].map(el => [el.dataset.id, el]));

      filteredDocs.forEach(doc => {
        const catColor = getCategoryColor(doc.category);
        
        if (existingCards.has(doc.__backendId)) {
          // Update existing card
          const card = existingCards.get(doc.__backendId);
          card.querySelector('.doc-name').textContent = doc.name;
          card.querySelector('.doc-type-icon').innerHTML = getTypeIcon(doc.type);
          card.querySelector('.doc-category').textContent = doc.category;
          card.querySelector('.doc-category').style.background = catColor.bg;
          card.querySelector('.doc-category').style.color = catColor.text;
          card.querySelector('.doc-date').textContent = formatDate(doc.createdAt);
          card.querySelector('.doc-size').textContent = doc.size || '-';
          existingCards.delete(doc.__backendId);
        } else {
          // Create new card
          const card = document.createElement('div');
          card.className = 'doc-card rounded-2xl border p-5 cursor-pointer';
          card.style.cssText = 'background: #ffffff; border-color: #e2e8f0; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);';
          card.dataset.id = doc.__backendId;
          card.innerHTML = `
            <div class="flex items-start justify-between mb-4">
              <div class="w-12 h-12 rounded-xl flex items-center justify-center doc-type-icon" style="background: rgba(99, 102, 241, 0.1); color: #6366f1;">
                ${getTypeIcon(doc.type)}
              </div>
              <div class="flex gap-1">
                <button onclick="event.stopPropagation(); editDocument('${doc.__backendId}')" class="p-2 rounded-lg transition-colors hover:bg-gray-100" style="color: #94a3b8;" aria-label="Modifier">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button onclick="event.stopPropagation(); confirmDelete('${doc.__backendId}')" class="p-2 rounded-lg transition-colors hover:bg-red-100" style="color: #f87171;" aria-label="Supprimer">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </div>
            <h3 class="doc-name text-lg font-semibold mb-2 truncate" style="color: #1e293b;">${doc.name}</h3>
            <div class="flex items-center gap-2 mb-3">
              <span class="doc-category category-pill px-3 py-1 rounded-full text-xs font-medium" style="background: ${catColor.bg}; color: ${catColor.text};">${doc.category}</span>
            </div>
            <div class="flex items-center justify-between text-sm" style="color: #94a3b8;">
              <span class="doc-date">${formatDate(doc.createdAt)}</span>
              <span class="doc-size">${doc.size || '-'}</span>
            </div>
          `;
          grid.appendChild(card);
        }
      });

      // Remove cards not in filtered list
      existingCards.forEach(card => card.remove());

      // Show limit warning if needed
      const limitWarning = document.getElementById('limit-warning');
      if (currentRecordCount >= 999) {
        limitWarning.classList.remove('hidden');
      } else {
        limitWarning.classList.add('hidden');
      }
    }

    // Update statistics
    function updateStats() {
      document.getElementById('total-docs').textContent = documents.length;
      document.getElementById('pdf-count').textContent = documents.filter(d => d.type === 'PDF').length;
      document.getElementById('image-count').textContent = documents.filter(d => d.type === 'Image').length;
      document.getElementById('other-count').textContent = documents.filter(d => !['PDF', 'Image'].includes(d.type)).length;
    }

    // Modal functions
    function openModal(doc = null) {
      editingDoc = doc;
      const modal = document.getElementById('modal');
      const title = document.getElementById('modal-title');
      const submitText = document.getElementById('submit-text');
      const form = document.getElementById('doc-form');

      if (doc) {
        title.textContent = 'Modifier le document';
        submitText.textContent = 'Enregistrer';
        document.getElementById('doc-name').value = doc.name;
        document.getElementById('doc-type').value = doc.type;
        document.getElementById('doc-category').value = doc.category;
        document.getElementById('doc-size').value = doc.size || '';
        document.getElementById('doc-description').value = doc.description || '';
      } else {
        title.textContent = 'Nouveau Document';
        submitText.textContent = 'Ajouter le document';
        form.reset();
      }

      modal.classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('modal').classList.add('hidden');
      editingDoc = null;
    }

    function editDocument(id) {
      const doc = documents.find(d => d.__backendId === id);
      if (doc) openModal(doc);
    }

    function confirmDelete(id) {
      deletingDoc = documents.find(d => d.__backendId === id);
      document.getElementById('delete-modal').classList.remove('hidden');
    }

    function closeDeleteModal() {
      document.getElementById('delete-modal').classList.add('hidden');
      deletingDoc = null;
    }

    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const toastIcon = document.getElementById('toast-icon');

      toastMessage.textContent = message;
      
      if (type === 'success') {
        toastIcon.style.background = 'rgba(34, 197, 94, 0.2)';
        toastIcon.innerHTML = `<svg class="w-5 h-5" style="color: #4ade80;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`;
      } else {
        toastIcon.style.background = 'rgba(239, 68, 68, 0.2)';
        toastIcon.innerHTML = `<svg class="w-5 h-5" style="color: #f87171;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`;
      }

      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    // Drawer is now always visible - no functions needed

    // Setup event listeners
    function setupEventListeners() {

      // Add document buttons
      document.getElementById('add-doc-btn').addEventListener('click', () => {
        if (currentRecordCount >= 999) {
          showToast('Limite de 999 documents atteinte', 'error');
          return;
        }
        openModal();
      });

      document.getElementById('add-first-doc').addEventListener('click', () => {
        if (currentRecordCount >= 999) {
          showToast('Limite de 999 documents atteinte', 'error');
          return;
        }
        openModal();
      });

      // Form submission
      document.getElementById('doc-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submit-btn');
        const submitText = document.getElementById('submit-text');
        const submitSpinner = document.getElementById('submit-spinner');

        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitSpinner.classList.remove('hidden');

        const docData = {
          name: document.getElementById('doc-name').value.trim(),
          type: document.getElementById('doc-type').value,
          category: document.getElementById('doc-category').value,
          size: document.getElementById('doc-size').value.trim(),
          description: document.getElementById('doc-description').value.trim(),
          createdAt: editingDoc ? editingDoc.createdAt : new Date().toISOString()
        };

        try {
          let result;
          if (editingDoc) {
            result = await window.dataSdk.update({ ...editingDoc, ...docData });
          } else {
            if (currentRecordCount >= 999) {
              showToast('Limite de 999 documents atteinte', 'error');
              return;
            }
            result = await window.dataSdk.create(docData);
          }

          if (result.isOk) {
            showToast(editingDoc ? 'Document modifié' : 'Document ajouté');
            closeModal();
          } else {
            showToast('Une erreur est survenue', 'error');
          }
        } catch (err) {
          showToast('Une erreur est survenue', 'error');
        } finally {
          submitBtn.disabled = false;
          submitText.classList.remove('hidden');
          submitSpinner.classList.add('hidden');
        }
      });

      // Delete confirmation
      document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
        if (!deletingDoc) return;

        const btn = document.getElementById('confirm-delete-btn');
        btn.disabled = true;
        btn.textContent = 'Suppression...';

        try {
          const result = await window.dataSdk.delete(deletingDoc);
          if (result.isOk) {
            showToast('Document supprimé');
            closeDeleteModal();
          } else {
            showToast('Erreur lors de la suppression', 'error');
          }
        } catch (err) {
          showToast('Erreur lors de la suppression', 'error');
        } finally {
          btn.disabled = false;
          btn.textContent = 'Supprimer';
        }
      });

      // Search and filter
      document.getElementById('search-input').addEventListener('input', renderDocuments);
      document.getElementById('category-filter').addEventListener('change', renderDocuments);
    }

    // Initialize app
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d01b27ed5fc11e6',t:'MTc3MTQ2MTQ2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
